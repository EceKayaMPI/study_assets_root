
<!DOCTYPE html>
<html>
<head>
  <script src="jatos.js"></script>

  <script src="ToneY.js"></script>

  <script src="jspsych-6.1.0/jspsych.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-WOB-slider-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-button-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-keyboard-responseSSS.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>

  <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>
<body></body>
<script>

var timeVar = [];

var audio_stims = [
  {stimulus: 'stimfiles/AM_4.00_Hz_0.03dep.wav'},
  {stimulus: 'stimfiles/AM_4.00_Hz_0.06dep.wav'},
  {stimulus: 'stimfiles/AM_4.00_Hz_0.09dep.wav'},
];

// files to load
var audio_files = [
    "stimfiles/AM_4.00_Hz_0.03dep.wav",
    "stimfiles/AM_4.00_Hz_0.06dep.wav",
    "stimfiles/AM_4.00_Hz_0.09dep.wav",
];

//
//
//
//var trial_index_list = [1,2,3]
// var promise = jatos.batchSession.add("/subjects/2", {id: 123, name: "Max"});
// promise.done(() => { alert("Batch Session was successfully updated") });
// promise.fail(() => { alert("Batch Session synchronization failed") });
//if (typeof(jatos.batchSession.get(id)) !== "undefined") {
  // This ID exists in the batch data. Get the trial index array for this participant.
//  trial_index_list = jatos.batchSession.get(id);
//}

// other variables -- >>> most at external json

var SMT_stop = {
      type: 'html-button-response',
      stimulus:
      '<p>You can stop tapping.</p>',
      choices: ['Continue']
    }
var SMT_procedure = {
  timeline: [SMT_stop],
  repetitions: 1,
  randomize_order: false,
}
timeVar.push(SMT_procedure);





// TRIALS -----------------------------------------------------------------
var test_trials = {
  type: 'audio-keyboard-response',
  stimulus: jsPsych.timelineVariable('stimulus'),
  choices: ['w', 'n'],
  prompt: '<p style="font-size:60px;">+</p>',
  response_ends_trial: true,
  trial_duration:1050,
}
var test_procedure = {
  timeline: [test_trials],
  timeline_variables: audio_stims,
  repetitions: 1,
  randomize_order: true,
}
timeVar.push(test_procedure);


// kay byeeeeee  ----------------------------------------------------
var thxbye = {
      type: 'html-button-response',
      stimulus: '<p style="font-size:30px;">Thank you!</p>' +
      '<p>You have completed the experiment.</p>'+
      '<p>Click <strong>continue</strong> to close.</p>',
      choices: ['Continue']
    };
timeVar.push(thxbye);

// initiate experiment


jatos.onLoad(function() {

      var urlstuff = jatos.urlQueryParameters;
      console.log(urlstuff);

      if (urlstuff.PROLIFIC_PID === "{{ececik}}") {
        var x = 666;
      } else {
        var x = 333;
      }
      console.log(x)


      jsPsych.init({
        timeline: timeVar,
        use_webaudio: false,
        preload_audio: audio_files,
        on_close: function() {
          var resultJson = jsPsych.data.get().json();
          jatos.submitResultData(resultJson, jatos.startNextComponent);
        },

        on_finish: function() {
          // var resultCSV = jsPsych.data.get().csv();
          // var promise = jatos.uploadResultFile(resultCSV, 'datacik.csv');
          // promise.done(() => { alert("File was successfully uploaded") });
          // promise.fail(() => { alert("File upload failed") });
          var resultJson = jsPsych.data.get().json();
          jatos.studySessionData["subject_id"] = subject_id;
          jatos.submitResultData(resultJson, jatos.startNextComponent);

        },

        default_iti: 600
      });
});

</script>

</html>
