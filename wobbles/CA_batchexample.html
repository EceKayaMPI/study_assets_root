<!DOCTYPE html>
<html>

<head>
  <title>My experiment</title>
  <script src="global_JS.js"></script>
  <script src="jspsych-6.1.0/jspsych.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-audio-keyboard-response.js"></script>
  <script src="jatos.js"></script>
  <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css">
  </link>
</head>

<body></body>
<script>

  var subj_ID = jsPsych.data.getURLVariable('prolific_id')
  console.log(subj_ID)


  var timeVar = [];

  function init_experiment() {
    jsPsych.init({
      timeline: timeVar,
      on_finish: function() {
        var resultJson = jsPsych.data.get().json();
        jatos.submitResultData(resultJson, jatos.startNextComponent);
      }
    })
  }

  jatos.onLoad(function() {
    // Extract url var (here prolific_id)
    var prolific_id = jatos.urlQueryParameters.prolific_id
    if (prolific_id) {
      // existing ID
      if (jatos.batchSession.find('/' + prolific_id)) {
        // If, start experiment
        // AIM: find participant order in stims4all_demo and select that stim order in the experiment
        init_experiment();
        // new ID
      } else {
        // count existing participants
        var batchSession = jatos.batchSession.getAll();
        var pt_index = Object.keys(batchSession).length;
        //console.log(pt_index)
        // add new ID to session data
        var promise = jatos.batchSession.add('/' + prolific_id, pt_index);
        // if added, start experiment
        promise.done(() => {
          init_experiment();
        });
      }
    } else {
      alert('no prolific id given!')
      jatos.abortStudy();
    }

  });
</script>

</html>
